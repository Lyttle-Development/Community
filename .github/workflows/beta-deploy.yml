name: Deploy BETA

on:
  workflow_run:
    workflows:
      - "Build and Push BETA API Docker Image"
      - "Build and Push BETA Client Docker Image"
      - "Build and Push BETA Dashboard Docker Image"
    types:
      - completed

jobs:
  deploy:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        node-version: [18.x]

    steps:
      - name: Deploy BETA to FR001
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.FR001_HOST }}
          username: ${{ secrets.FR001_USERNAME }}
          password: ${{ secrets.FR001_PASSWORD }}
          script: |
            sudo systemctl restart application.docker.community-v3.api.service
            sudo systemctl restart application.docker.community-v3.client.service
      - name: Deploy BETA to DE001
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.DE001_HOST }}
          username: ${{ secrets.DE001_USERNAME }}
          password: ${{ secrets.DE001_PASSWORD }}
          script: |
            sudo systemctl restart application.docker.community-v3.dashboard.service
